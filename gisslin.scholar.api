import requests
import json
import gzip
import io

def peek_abstracts_data(file_url, num_lines=5):
    """
    ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Semantic Scholar ‡πÅ‡∏ö‡∏ö Stream (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á‡πÑ‡∏ü‡∏•‡πå)
    ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    """
    print(f"üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Stream... \nURL: {file_url[:50]}...")
    
    # 1. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏ö‡∏ö Stream (stream=True ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà)
    with requests.get(file_url, stream=True) as response:
        response.raise_for_status()
        
        # 2. ‡πÉ‡∏ä‡πâ gzip ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        # response.raw ‡∏Ñ‡∏∑‡∏≠ file-like object ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö
        with gzip.GzipFile(fileobj=response.raw) as f:
            
            # 3. ‡πÉ‡∏ä‡πâ TextIOWrapper ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á bytes ‡πÄ‡∏õ‡πá‡∏ô string (utf-8)
            reader = io.TextIOWrapper(f, encoding='utf-8')
            
            print(f"‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á {num_lines} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å:\n" + "="*50)
            
            count = 0
            for line in reader:
                if count >= num_lines:
                    break
                
                try:
                    # 4. ‡πÅ‡∏õ‡∏•‡∏á Text Line ‡πÄ‡∏õ‡πá‡∏ô JSON Object
                    data = json.loads(line)
                    print(f"üìÑ [Record {count+1}]: ID {data.get('paperId', 'N/A')}")
                    print(json.dumps(data, indent=2, ensure_ascii=False))
                    print("-" * 50)
                    count += 1
                except json.JSONDecodeError:
                    print(f"‚ö†Ô∏è Error decoding line {count+1}")
                    continue

# --- Usage ---

# ‡∏à‡∏≥‡∏•‡∏≠‡∏á URL ‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ r3['files'][0] ‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤
# ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: URL ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏û‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ URL ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å r3['files'] ‡πÉ‡∏ô session ‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å URL ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏‡∏à‡∏≥‡∏Å‡∏±‡∏î (Presigned URL)
# ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏û‡∏µ‡πà‡∏£‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å code ‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ:
# target_url = r3['files'][0] 

# ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏ú‡∏°‡∏à‡∏∞‡πÉ‡∏ä‡πâ URL ‡∏à‡∏≥‡∏•‡∏≠‡∏á (‡∏û‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥ URL ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å r3 ‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö)
# target_url = "https://ai2-s2ag.s3.amazonaws.com/..." 

print("üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ô‡∏≥ URL ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ r3['files'][0] ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö")
# peek_abstracts_data(target_url) 
